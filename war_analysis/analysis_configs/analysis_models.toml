# Definitions for each analysis model (GLM variation).

# --- Model: by_block ---
# Replicates the analysis from first_level_analysis_by_block.sh
[by_block]
description = "GLM analysis by emotional block (Negative, Positive, Neutral)."
stim_files = [
    "timings/negative_block.1D",
    "timings/positive_block.1D",
    "timings/neutral_block.1D",
    "timings/rest.1D"
]
stim_labels = ["neg_blck", "pos_blck", "neut_blck", "rest"]
basis = "BLOCK(22,1)"
requires_scr = false
glt = [
    { sym = "neg_blck - neut_blck", label = "neg-neut_blck" },
    { sym = "neg_blck - rest", label = "neg_blck-rest" },
    { sym = "pos_blck - neut_blck", label = "pos-neut_blck" },
    { sym = "neg_blck - pos_blck", label = "neg-pos_blck" }
]

# --- Model: by_scr_bins ---
# Replicates the analysis from first_level_analysis_by_scr_bins.sh
[by_scr_bins]
description = "GLM analysis using binned SCR as a regressor."
stim_files = [
    "timings/scr_binned.1D"
]
stim_labels = ["SCR"]
basis = "GAM"
stim_types = "file" # Special case for afni_proc.py
requires_scr = true
glt = []

# --- Group Analyses for by_block model ---

[[by_block.group_analyses]]
name = "mdma_vs_control_s1"
type = "3dLMEr"
model = "group*stimulus+(1|Subj)"
description = "Compare MDMA vs Control groups in session 1 for each stimulus."
groups = ["MDMA", "Control"]
subject = { "MDMA" = ["sub-MD01"], "Control" = ["sub-AL01"] }
sessions = [1]
data_table_rows = [
    { stimulus = "neg",  contrast = "neg_blck#0_Coef" },
    { stimulus = "pos",  contrast = "pos_blck#0_Coef" },
    { stimulus = "neut", contrast = "neut_blck#0_Coef" }
]
glt = [
    { sym = "group : 1*MDMA -1*Control stimulus : 1*neg", label = "neg_mdma_gt_control" },
    { sym = "group : 1*MDMA -1*Control stimulus : 1*pos", label = "pos_mdma_gt_control" },
    { sym = "group : 1*MDMA -1*Control stimulus : 1*neut", label = "neut_mdma_gt_control" }
]

[[by_block.group_analyses]]
name = "mdma_session_comparison"
type = "3dLMEr"
model = "session*stimulus+(1|Subj)"
description = "Compare session 2 vs session 1 for the MDMA group."
groups = ["MDMA"]
sessions = [1, 2]
subjects = ["sub-MD01"]
data_table_rows = [
    { stimulus = "neg",  contrast = "neg_blck#0_Coef" },
    { stimulus = "pos",  contrast = "pos_blck#0_Coef" },
    { stimulus = "neut", contrast = "neut_blck#0_Coef" }
]
glt = [
    { sym = "session : 1*ses-2 -1*ses-1 stimulus : 1*neg", label = "neg_s2_gt_s1" },
    { sym = "session : 1*ses-2 -1*ses-1 stimulus : 1*pos", label = "pos_s2_gt_s1" },
    { sym = "session : 1*ses-2 -1*ses-1 stimulus : 1*neut", label = "neut_s2_gt_s1" }
]

[[by_block.group_analyses]]
name = "mdma_s1_neg_vs_neut"
type = "3dttest++"
description = "One-sample t-test for the MDMA group in session 1 on the neg-neut contrast."
groups = ["MDMA"]
sessions = [1]
contrast = "neg-neut_blck#0_Coef"
setA_label = "MDMA_S1_NegVsNeut"